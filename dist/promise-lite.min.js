!function(t){"use strict";function e(t){if("function"==typeof t){var n=new e;return t(n.resolve.bind(n),n.reject.bind(n)),n}return this.state="pending",this.thenables=[],this}e.prototype.resolve=function(t){return"pending"===this.state?(this.state="fulfilled",this.value=t,this._handleThen(),this):void 0},e.prototype.reject=function(t){return"pending"===this.state?(this.state="rejected",this.reason=t,this._handleThen(),this):void 0},e.prototype.then=function(t,n){var i={};return"function"==typeof t&&(i.fulfill=t),"function"==typeof n&&(i.reject=n),"pending"!==this.state&&setTimeout(this._handleThen.bind(this),0),i.promise=new e,this.thenables.push(i),i.promise},e.prototype.all=function(t){var e=this,n=0,i=[],s=t.length;return t.forEach(function(t){var r=n++;t.then(function(t){i[r]=t,0===--s&&e.resolve(i)},function(t){e.reject(t)})}),this},e.prototype.race=function(t){var e=this;return t.forEach(function(t){t.then(function(t){e.resolve(t)},function(t){e.reject(t)})}),this},e.prototype["catch"]=function(t){return this.then(null,t)},e.prototype._handleThen=function(){if("pending"!==this.state)for(;this.thenables.length&&this.thenables[0].promise;){var t,n=this.thenables[0],i=n.promise;try{"fulfilled"===this.state?n.fulfill?t=n.fulfill(this.value):i.resolve(this.value):"rejected"===this.state&&(n.reject?t=n.reject(this.reason):i.reject(this.reason)),null===t||void 0===t?i.resolve(this.value):t instanceof e||"function"==typeof t.then?t.then(i.resolve.bind(i),i.reject.bind(i)):i.resolve(t)}catch(s){i.reject(s)}this.thenables.shift()}},"Promise"in t||(t.Promise=e)}(window);