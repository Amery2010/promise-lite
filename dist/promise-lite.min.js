!function(){"use strict";function t(e){if("function"==typeof e){var n=new t;return e(n.resolve.bind(n),n.reject.bind(n)),n}return this.state="pending",this.thenables=[],this}t.prototype.resolve=function(t){return"pending"===this.state?(this.state="fulfilled",this.value=t,this._handleThen(),this):void 0},t.prototype.reject=function(t){return"pending"===this.state?(this.state="rejected",this.reason=t,this._handleThen(),this):void 0},t.prototype.then=function(e,n){var i={};return"function"==typeof e&&(i.fulfill=e),"function"==typeof n&&(i.reject=n),"pending"!==this.state&&setTimeout(this._handleThen.bind(this),0),i.promise=new t,this.thenables.push(i),i.promise},t.prototype.all=function(t){var e=this,n=0,i=[],s=t.length;return t.forEach(function(t){var h=n++;t.then(function(t){i[h]=t,0===--s&&e.resolve(i)},function(t){e.reject(t)})}),this},t.prototype.race=function(t){var e=this;return t.forEach(function(t){t.then(function(t){e.resolve(t)},function(t){e.reject(t)})}),this},t.prototype["catch"]=function(t){return this.then(null,t)},t.prototype._handleThen=function(){if("pending"!==this.state)for(;this.thenables.length&&this.thenables[0].promise;){var e,n=this.thenables[0],i=n.promise;try{"fulfilled"===this.state?n.fulfill?e=n.fulfill(this.value):i.resolve(this.value):"rejected"===this.state&&(n.reject?e=n.reject(this.reason):i.reject(this.reason)),null===e||void 0===e?i.resolve(this.value):e instanceof t||"function"==typeof e.then?e.then(i.resolve.bind(i),i.reject.bind(i)):i.resolve(e)}catch(s){i.reject(s)}this.thenables.shift()}}}();